#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
#set -e

# debug
set -ex

# parse and derive params
LP_DIR=`cd $(dirname $0); cd ..; pwd`
BUILD_DIR=$1
CACHE_DIR=$2
ARTANIS_VERSION=0.4

function indent() {
	c='s/^/       /'

	case $(uname) in
		Darwin)
			sed -l "$c"
			;;
		*)
			sed -u "$c"
			;;
	esac
}

function topic() {
	echo "-----> $*"
}



mkdir -p $BUILD_DIR/.apt

#give environment to later buildpacks
export | grep -E -e ' (PATH|LD_LIBRARY_PATH|LIBRARY_PATH|INCLUDE_PATH|CPATH|CPPPATH|PKG_CONFIG_PATH|GUILE_LOAD_PATH)=' > "$LP_DIR/export"



cd /tmp

topic "Installing Artanis"
wget -c http://ftp.gnu.org/gnu/artanis/artanis-$ARTANIS_VERSION.tar.bz2  && \
	tar xvjf artanis-$ARTANIS_VERSION.tar.bz2                              && \
	rm -f artanis-$ARTANIS_VERSION.tar.bz2                                 && \
	cd artanis-$ARTANIS_VERSION                                            && \
	./configure && make && make install DESTDIR="$BUILD_DIR/.apt" && cd ..

topic "Search"
find $BUILD_DIR -iname artanis | indent
